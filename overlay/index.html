<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Overlay PoseEdit</title>

  <style>
    body {
      margin: 0;
      background: transparent;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      user-select: none;
    }

    img {
      max-width: 60%;
      max-height: 80%;
      opacity: 0;
      border-radius: 12px;
      transition: opacity 0.5s ease;
      pointer-events: none;
    }

    .show {
      opacity: 1;
    }
  </style>
</head>

<body>
  <img id="meme" src="" alt="" />

  <script src="config.js"></script>
  <script>
    const { SERVER_IP, SERVER_PORT, DISPLAY_TIME = 3000 } = window.POSEEDIT_CONFIG;
    const WS_URL = `ws://${SERVER_IP}:${SERVER_PORT}/ws`;
    const BASE_URL = `http://${SERVER_IP}:${SERVER_PORT}/`;

    const img = document.getElementById("meme");
    let hideTimeout = null;

    function displayImage(path) {
      const url = `${BASE_URL}${path}?t=${Date.now()}`;

      img.classList.remove("show");
      img.src = url;

      img.onload = () => {
        img.classList.add("show");

        clearTimeout(hideTimeout);
        hideTimeout = setTimeout(() => {
          img.classList.remove("show");
        }, DISPLAY_TIME);
      };
    }

    function connectWS() {
      const ws = new WebSocket(WS_URL);

      ws.onopen = () => console.log("ðŸŸ¢ WS conectado:", WS_URL);

      ws.onmessage = (ev) => {
        try {
          const data = JSON.parse(ev.data);
          if (data?.meme) displayImage(data.meme);
        } catch {
          console.warn("Mensagem ignorada (invÃ¡lida).");
        }
      };

      ws.onerror = () => console.warn("ðŸš¨ Erro no WebSocket.");
      ws.onclose = () => {
        console.warn("ðŸ”´ WS desconectado. Reconectando...");
        setTimeout(connectWS, 3000);
      };
    }

    connectWS();
  </script>
</body>
</html>
